{% extends "index.html" %}

{% block title %} L-Py Editor {% endblock %}
	
{% block body %}
	<body class="bg-light">
		<form>
{% endblock %}

{% block editor %}{% endblock %}

{% block content %}
			<div class="row bg-light">
				<div id="fileButtons">
					<button type="button" class="btn btn-light text-success" id="clearEditor" alt="Reset the editor text." title="Reset the editor text."><i class="fas fa-eraser"></i> Clear</button>
					<input type="file" id="hiddenButton" accept=".lpy"/>
					<button type="button" class="btn btn-light text-success" id="importFile" alt="Import a .lpy file from your local storage." title="Import a .lpy file from your local storage.">
						<i class="fas fa-file-upload"></i> Load from file</button>
					<button type="button" class="btn btn-light text-success" id="importExample" alt="Import a .lpy file from an URL." title="Import a .lpy example file from the database." data-toggle="modal" data-target="#modalExample" style="display: none;">
					<i class="fas fa-file-upload"></i> Load Example</button>
					<!--<button type="button" class="btn btn-light text-success" id="importURL" alt="Import a .lpy file from an URL." title="Import a .lpy file from an URL." data-toggle="modal" data-target="#modalFileURL">
						<i class="fas fa-file-upload"></i> Load from URL</button>-->
					<button type="button" class="btn btn-light text-success" id="downloadButton" alt="Save your program in a .lpy file and download it."
					title="Save your program in a .lpy file and download it." data-toggle="modal" data-target="#modalFilename"><i class="fas fa-save"></i> Save</button>
				</div>
				<div id="submitButtons">
					<button type="submit" class="btn btn-light text-success" id="runCode" alt="Run your program and display the render."
					title="Run your program and display the render."><i class="fas fa-play"></i> Run</button>
					<button type="submit" class="btn btn-light text-success" id="stepCode" alt="Run your program step by step."
					title="Run your program step by step."><i class="fas fa-step-forward"></i> Step</button>
					<button type="button" class="btn btn-light text-success" id="animate" alt="Play the growth animation" title="Play the growth animation"><i class="fas fa-film"></i> Animate</button>
				</div>
				<div id="docButton">
					<a type="button" class="btn btn-light text-success" alt="Read some documentation" title="Read some documentation"
					href="https://lpy-anthony.readthedocs.io/en/latest/user/turtleBasic.html" target="_blank"><i class="fas fa-book"></i> Documentation</a>
				</div>
			</div>
			<div class="row" id="row-main">
				<div class="col-md-5" style="position: relative;">
					<textarea placeholder="Axiom and rules" type="text" name="code" wrap=off>Axiom:

derivation length: 1
production:

interpretation:

endlsystem
	</textarea>
					<div id="code"></div>
					<input type="hidden" name="step" id="step" readonly>
				</div>
				<div class="col-md-7">
					<canvas width="600" height="800" id="renderCanvas"></canvas>
				</div>
			</div>

			<!-- Filename Modal -->

			<div class="modal fade" id="modalFilename" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	 			<div class="modal-dialog" role="document">
	    			<div class="modal-content">
	      				<div class="modal-header">
	      					<h3 class="modal-title">Save as</h3>
	        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	      				</div>
	      				<div class="modal-body">
	        				<b><center><label for="filename">Enter a name for the file (between 1 and 50 caracters) : </label></b>
		        			<input class="flex-column" type="text" name="filename" id="filename" minlength="1" maxlength="50" size="48" value="file.lpy" required></center>
		        		</div>
		        		<div class="modal-footer">
        					<button type="button" class="btn btn-primary" id="modalSaveButton">Save</button>
      					</div>     
		        	</div>
		        </div>
		    </div>

		    <div class="modal fade" id="modalExample" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	 			<div class="modal-dialog" role="document">
	    			<div class="modal-content">
	      				<div class="modal-header">
	      					<h3 class="modal-title"> Load an example</h3>
	        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	      				</div>
	      				<div class="modal-body">
	        				<b><center><label for="exampleFile">Choose the example file you want to load in the editor : </label></b><br />
		        			<select class="flex-column" type="url" name="exampleFile" id="exampleFile" required>
		        			</select></center>
		        		</div>
		        		<div class="modal-footer">
        					<button type="button" class="btn btn-primary" id="modalLoadExample">Load</button>
      					</div>     
		        	</div>
		        </div>
		    </div>

		    <!--<div class="modal fade" id="modalFileURL" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	 			<div class="modal-dialog" role="document">
	    			<div class="modal-content">
	      				<div class="modal-header">
	      					<h3 class="modal-title"> Load a file from the Web</h3>
	        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	      				</div>
	      				<div class="modal-body">
	        				<b><center><label for="fileURL">Enter the URL of the file you want to load in the editor : </label></b>
		        			<input class="flex-column" type="url" name="fileURL" id="fileURL" placeholder="https://example.com" pattern="https://.*" size="48" required></center>
		        		</div>
		        		<div class="modal-footer">
        					<button type="button" class="btn btn-primary" id="modalLoadButton">Load</button>
      					</div>     
		        	</div>
		        </div>
		    </div>-->

		</form>
{% endblock %}

{% block script %}
		<script>
			var editor = ace.edit("code");
			var textarea = $('textarea[name="code"]').hide();
			document.getElementById('code').style.fontSize='16px';
			editor.setTheme("ace/theme/gruvbox");
			editor.session.setMode("ace/mode/python");
			editor.getSession().setValue(textarea.val());
			if(!sessionStorage.getItem('genesisCode')) {
				sessionStorage.setItem('genesisCode', editor.getSession().getValue());
			}
			editor.getSession().on('change', function(){
				textarea.val(editor.getSession().getValue());
			});

			function resize() {
    			var h = window.innerHeight;
    			console.log(h);
		    	if (h > 1050) {
		    		$('#code').css('height', (h - 109).toString() + 'px');
		    		$('#renderCanvas').css('height', (h - 109).toString() + 'px');
		    	}
			};

			$(window).on('resize', function () {
		    	resize();
			});
			resize();

			document.getElementById("importFile").addEventListener("click", () => upload());
			document.getElementById("hiddenButton").addEventListener("input", () => hiddenUpload(editor));
			document.getElementById("modalSaveButton").addEventListener("click", () => downloadFile(editor));
			//document.getElementById("modalLoadExample").addEventListener("click", () => loadExample(editor));
			document.getElementById("clearEditor").addEventListener('click', () => clearEditor(editor));
			document.getElementById("animate").addEventListener('click', () => animate(1));
			//document.getElementById("modalLoadButton").addEventListener("click", () => loadFromURL(editor));
			
		</script>
{% endblock %}