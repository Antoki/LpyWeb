{% extends "index.html" %}

{% block title %} L-Py Editor {% endblock %}
	
{% block body %}
	<body onload="Init();">		
		<form>
{% endblock %}

{% block editor %}{% endblock %}

{% block content %}
			<div class="row" id="row-main">
				<div class="col-md-2" id="sidebar">
					<div id="sidebarTitle">Actions</div>
					<input type="file" id="hiddenButton" accept=".lpy"/>
					<button type="button" class="btn btn-primary btn-block " id="importButton" alt="Import a .lpy file." title="Import a .lpy file and load it in the editor.">
						<i class="fas fa-file-upload"></i> Import</button>
					<button type="button" class="btn btn-danger btn-block" id="downloadButton" alt="Save your program in a .lpy file and download it." 
					title="Save your program in a .lpy file and download it." data-toggle="modal" data-target="#modalFilename"><i class="fas fa-save"></i> Save</button>
					<div id="submitButtons">
						<button type="submit" class="btn btn-success btn-block" id="submitCode" alt="Run your program and display the render." 
						title="Run your program and display the render."><i class="fas fa-play"></i> Simulate</button>
						<button type="submit" class="btn btn-warning btn-block text-light" id="stepSubmit" alt="Run your program step by step." 
						title="Run your program step by step."><i class="fas fa-step-forward"></i> Step</button>
					</div>
					<div id="docButton">
						<a type="button" class="btn btn-info btn-block" alt="Read some documentation" title="Read some documentation" 
						href="https://lpy-anthony.readthedocs.io/en/latest/user/turtleBasic.html" target="_blank"><i class="fas fa-book"></i> Documentation</a>
					</div>
				</div>
				<div class="col-md-4" style="position: relative;">
					<textarea placeholder="Axiom and rules" type="text" name="code" wrap=off>Axiom:

derivation length: 1
production:

interpretation:

endlsystem
	</textarea>
					<div id="code"></div>
				</div>
				<div class="col-md-6">
					<canvas width="600" height="600" id="renderCanvas">
						<input type="hidden" id=htmlLString name="htmlLString">
					</canvas>
				</div>
			</div>

			<!-- Filename Modal -->

			<div class="modal fade" id="modalFilename" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	 			<div class="modal-dialog" role="document">
	    			<div class="modal-content">
	      				<div class="modal-header">
	      					<h3 class="modal-title">Save as</h3>
	        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	      				</div>
	      				<div class="modal-body">
	        				<b><center><label for="filename">Enter a name for the file (between 1 and 50 caracters) : </label></center></b>
		        			<input class="flex-column" type="text" name="filename" id="filename" minlength="1" maxlength="50" size="48" value="file.lpy" required>
		        		</div>
		        		<div class="modal-footer">
        					<button type="button" class="btn btn-primary" id="modalSaveButton">Save</button>
      					</div>     
		        	</div>
		        </div>
		    </div>
		</form>
{% endblock %}
{% block wrapper %}
		<div id="wrapperEditor">
{% endblock %}

{% block script %}
		<script>

			$(document).ready(function() {
				//$('#submitCode').on('click', function(){
					$('form').on('submit', function(event) {

						$.ajax({
							data : {
								LString : $('textarea[name="code"]').val(),
								code : $('textarea[name="code"]').val()
							},
							type : "POST",
							url : '/simulate',
							success: function(data) {
								if(data.error) {
									console.log(data.error)
									$('#htmlLString').val(data.error);
								}else {
									$('#htmlLString').val(data.LString);
									$('textarea[name="code"]').text(data.code);
									console.log(data.LString);
									console.log(data.code);
									console.log($('#htmlLString').val());
									Init();
								}
							}
						});

						event.preventDefault();
					});

				//});

			});

			var editor = ace.edit("code");
			var textarea = $('textarea[name="code"]').hide();
			document.getElementById('code').style.fontSize='16px';
			editor.setTheme("ace/theme/gruvbox");
			editor.session.setMode("ace/mode/python");
			editor.getSession().setValue(textarea.val());
			editor.getSession().on('change', function(){
				textarea.val(editor.getSession().getValue());
			});

			function resizeAce() {
    			var h = window.innerHeight;
    			console.log(h);
		    	if (h > 800) {
		       		$('#code').css('height', (h - 175).toString() + 'px');
		    	}
			};

			$(window).on('resize', function () {
		    	resizeAce();
			});
			resizeAce();

			document.getElementById("importButton").addEventListener("click", () => upload());
			document.getElementById("hiddenButton").addEventListener("input", () => hiddenUpload(editor));
			document.getElementById("modalSaveButton").addEventListener("click", () => downloadFile(editor));
			
		</script>
{% endblock %}